{% extends '@YesknBlog/base.html.twig' %}

{% block title %}<title>{{ post.title }} - Vmoex</title>{% endblock %}

{% block main %}
    <div class="home-content-main">
        <div class="content border-bottom">
            <h2>{{ post.title }}</h2>
            <p class="post-meta">
                <span><i class="fa fa-user"></i> <a data-pjax href="{{ path('user_home', {username: post.author.username}) }}">{{ post.author.nickname }}</a></span>
                <span class="category">
                     <a data-pjax href="{{ path('home_tab', {tab:post.tab.alias}) }}" class="badge">{{ post.tab.name|trans }}</a>
                </span>
                <span><i class="fa fa-clock-o"></i> {{ post.createdAt|ago }}</span>
                <span><i class="fa fa-eye"></i> {{ post.views }}{{ 'click'|trans }}</span>
                {% if post.comments.count %}
                    <span><i class="fa fa-commenting-o"></i>
                        <a data-pjax href="{{ path('yeskn_blog_show', {id:post.id}) }}#comments">{{ post.comments.count }}{{ 'comment'|trans }}</a>
                    </span>
                {% endif %}
                {% if is_granted('ROLE_ADMIN') %}
                    <a href="{{ path('yeskn_admin_post_edit', {id:post.id}) }}">编辑</a>
                {% endif %}
            </p>
            <div class="post-content">
                {{ post.content|raw }}
            </div>
            <div style="position: relative;bottom: 0;">
                {% if post.tags is not empty %}
                    <p><i class="fa  fa-tags item-tag"></i>
                        {% for tag in post.tags %}
                            <span class="item-tag"> {{ tag.name }} </span>
                        {% endfor %}
                    </p>
                {% endif %}
            </div>
        </div>
        {#<div class="post-actions border-bottom">#}
            {#<span><a href="">收藏</a></span>#}
            {#<span><a href="">感谢</a></span>#}
            {#<span><a href="">分享</a></span>#}
            {#<span><a href="">屏蔽</a></span>#}
            {#<span><a href="">举报</a></span>#}

            {#<span class="pull-right last">12次收藏 / 30次感谢</span>#}
        {#</div>#}
        <div class="comments" id="comments">
            <h3 class="border-bottom">{{ 'comment'|trans|upper }}</h3>
            {% if post.comments is not empty %}
                <ul class="chat">
                    {% for comment in post.comments %}
                        <li class="left clearfix comment-item">
                <span class="chat-img pull-left comment-user-avatar">
                    <img src="{{ asset(comment.user.avatar) }}" alt="User Avatar" class="img">
                </span>
                            <div class="comment-main chat-body clearfix">
                                <div class="comment-user-info">
                                    <strong class="primary-font"><a href="{{ path('user_home', {username: comment.user.username}) }}" data-pjax>{{ comment.user.nickname }}</a></strong>
                                   {% if comment.user.type == 'admin' %}
                                       <span class="mod-text" data-content="管理员" title="MOD">mod</span>
                                       {% elseif comment.user == post.author %}
                                           <span class="author-label" data-content="author" title="author">author</span>
                                   {% endif %}

                                    {% if comment.user.remark %}
                                        <span class="text-small-gray">[ {{ comment.user.remark }} ]</span>
                                    {% endif %}

                                    <span class="text-small-gray pull-right">#{{ loop.index }}</span>
                                </div>
                                <p>{{ comment.content|raw }}</p>

                                <div class="comment-footer">
                                    {% set hasThumb = comment.thumbUpUsers.contains(app.user) %}
                                    {% set open = hasThumb ? '' : '-o' %}
                                    <span class="thumb thumb-up" data-cid="{{ comment.id }}">
                                        <b>
                                          <i class="fa fa-thumbs{{ open }}-up {{ hasThumb ? 'text-success' : '' }}"></i>
                                        </b>
                                        <b class="thumb-count">{{ comment.thumbUpUsers.count ?: '赞' }}</b>
                                    </span>

                                    <span class="snow">·</span>

                                    <span><i class="fa fa-clock-o"></i> {{ comment.createdAt|ago }}</span>

                                    {#<span class="pull-right"> <i class="fa fa-ellipsis-h"></i></span>#}
                                </div>
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>{{ '暂无评论，快来抢沙发吧'|trans }}~~</p>
            {% endif %}

            <div class="form-group" style="margin-top: 20px">
                <label class="control-label required" for="editor-trigger">{{ '添加新的评论'|trans }}</label>
                <div id="editor-trigger"></div>
                <textarea id="editor-trigger" style="display:none;"></textarea>
                <p class="help-block">{{ '发表有颜色的评论将消耗5金币哦'|trans }}~</p>
            </div>
            <div class="form-group">
                {% if app.user %}
                    <button type="button" data-postId="{{ post.id }}" id="addCommentToPost" class="btn btn-info btn-sm">{{ '添加'|trans }}</button>
                {% else %}
                    <button type="button" class="btn btn-info btn-sm disabled">{{ '请先登录'|trans }}</button>
                {% endif %}

            </div>
        </div>
    </div>

    <script type="text/javascript">
      $(function () {
          var editor = new wangEditor('editor-trigger');

          editor.config.printLog = false;
          editor.config.menuFixed = false;

          editor.config.menus = [
              'source',
              '|',     // '|' 是菜单组的分割线
              'emotion',
              'bold',
              'underline',
              'italic',
              'strikethrough',
              'forecolor',
              'bgcolor',
              '|',
              'eraser'
          ];

          // 上传图片
          editor.config.uploadImgUrl = '/upload';
          editor.config.uploadParams = {
              // token1: 'abcde',
              // token2: '12345'
          };
          editor.config.uploadHeaders = {
              // 'Accept' : 'text/x-json'
          }
          // editor.config.uploadImgFileName = 'myFileName';

          // 表情显示项
          editor.config.emotionsShow = 'value';
          editor.config.emotions = {
              'default' : {
                  title: '(●′ω`●) 颜文字',
                  data: [
                      {
                          icon: null,
                          text: 'OωO',
                          value: 'OωO'
                      },
                      {
                          icon: null,
                          text: '|´・ω・)ノ',
                          value: '|´・ω・)ノ'
                      },
                      {
                          icon: null,
                          text: '⌇●﹏●⌇',
                          value: '⌇●﹏●⌇'
                      },
                      {
                          icon: null,
                          text: '(ฅ´ω`ฅ)',
                          value: '(ฅ´ω`ฅ)'
                      },
                      {
                          icon: null,
                          text: '→_→',
                          value: '→_→'
                      },
                      {
                          icon: null,
                          text: '＞﹏＜',
                          value: '＞﹏＜'
                      },
                      {
                          icon: null,
                          text: '￣へ￣',
                          value: '￣へ￣'
                      },
                      {
                          icon: null,
                          text: '（づ￣３￣）づ',
                          value: '（づ￣３￣）づ'
                      }
                  ]
              }
          };

          editor.create();
          window.editor = editor;
      })
    </script>
{% endblock %}

{% block sidebar %}
    {{ parent() }}
{% endblock %}

{% block sidebar_head %}
    <div class="panel panel-default">
        <div class="panel-heading">
            {{ '关于作者'|trans }}
            <div class="btn-group pull-right">
                <button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown"
                        aria-expanded="false">
                    <i class="fa fa-chevron-down"></i>
                </button>
                <ul class="dropdown-menu slidedown">
                    <li>
                        <a href="#">
                            <i class="fa fa-check-circle fa-fw"></i> {{ '拉黑'|trans }}
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="panel-body ">
                                <a href="{{ path('user_home', {username: post.author.username}) }}" data-pjax>{{ post.author.nickname }}</a>
        </div>
    </div>
{% endblock %}